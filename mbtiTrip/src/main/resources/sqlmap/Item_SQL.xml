<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="item">

	<insert id="create" useGeneratedKeys="true"
		keyProperty="itemID">
	insert into Item(Type, mbti, userName, price, itemName, location, tel, contents,updateDate,uprating)
	value(#{Type},#{mbti}, #{Username.userName}, #{price}, #{itemName},#{location}, #{tel}, #{contents}, #{updateDate},#{uprating})
	</insert>


	<select id="replaceList" resultType="hashMap">
		select * from Item
		where Type ="replace"
	</select>
	
	<select id="adventure" resultType ="hashMap">
		select * from Item
		where Type ="adventure"
	</select>
	
	<select id="myItem" resultType = "hashMap">
		select * from Item
		where userName = #{userName}
	</select>

	<select id="itemByMbti" resultType ="hashMap">
		select * from Item
		where mbti = #{mbti}
	</select>

	<select id="itemByLocation" resultType ="hashMap">
		select * from Item
		where location like #{location}%
	</select>

	<select id="mbtiAndLocation" resultType ="hashMap">
		selct * from Item
		where mbti =#{mbti} and location Like #{location}%
	</select>
	
	
	
	<delete id="deleteItem">
		delete from Item 
		where itemId = #{itemID}
	</delete>
	
	<select id="findById" resultType="int">
       <![CDATA[
		select ItemID
		from Item 
		where userName = #{userName}
       ]]>
    </select>
    
    <update id="updateCount">
	<![CDATA[
			Update Item 
			set
			views=#{views}
			where itemId = #{itemID};
		]]>
	</update>
 
 	<select id="getTotal" resultType="int">
       <![CDATA[
		select COUNT(ItemID)
		from Item 
		where itemId = #{itemID}
       ]]>
    </select>
 
 	<select id="getRatingAverage" resultType="int">
       <![CDATA[
		select avg(ratingAvg)
		from Item 
		where itemId = #{itemID}
       ]]>
    </select>
    
    <update id="updateRating">
	<![CDATA[
			Update Item 
			set
			ratingAvg=#{ratingAvg}
			where itemId = #{itemID};
		]]>
	</update>
	
	<update id="update">
	<![CDATA[
			Update Item 
			set
			Type=#{Type}, mbti=#{mbti}, userName=#{userName}, price=#{price}, itemName=#{itemName}, location=#{location}, tel=#{tel}, content=#{contents}, modifyDate=#{modifyDate}, imgeUrl=#{imgUrl}
			where itemId = #{itemID};
		]]>
	</update>
	
	<select id="getLastInsertId" resultType="int">
	<![CDATA[
    	SELECT LAST_INSERT_ID() from Item
    	]]>
	</select>
</mapper>