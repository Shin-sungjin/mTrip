<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userCart">

	<insert id="insertReplace" parameterType="hashMap"
		useGeneratedKeys="true">  
	<![CDATA[
		insert into userCart (userName, startDate, endDate, replaceID, payment)
	    values
        (#{userName}, #{StartDate}, #{endDate}, #{replaceInfo.replaceID}, #{payment})
   	]]>
	</insert>

	<insert id="insertAD" parameterType="hashMap"
		useGeneratedKeys="true">  
	<![CDATA[
		insert into userCart (userName, startDate, endDate, adventureID, payment)
	    values
        (#{userName}, #{StartDate}, #{endDate}, #{adventureInfo.adventureID}, #{payment})
 	]]>
	</insert>


	<select id="detail" resultMap="userCartResult">
	<![CDATA[
	select uc.userName, uc.startDate, uc.endDate,
		   re.Replace_name, re.Replace_location, re.price, re.contents, re.rating_avg,
       ad.adventureName, ad.adventureLocation, ad.adventurePrice, ad.adventureContent, ad.ratingAvg
		from `replace` re
		right join userCart uc
		on uc.replaceId = re.Replace_key
		left   join Adventure ad 
		on uc.adventureID = ad.adventureId  
		where uc.userName = #{userName} and uc.payment = false; 	
	]]>
	</select>
	<select id="detailPay" resultMap="userCartResult">
	 <![CDATA[
		select uc.userName, uc.startDate, uc.endDate,
				   re.Replace_name, re.Replace_location, re.price, re.contents, re.rating_avg,
		       ad.adventureName, ad.adventureLocation, ad.adventurePrice, ad.adventureContent, ad.ratingAvg
		from `replace` re
		right join userCart uc
		on uc.replaceId = re.Replace_key
		left   join Adventure ad 
		on uc.adventureID = ad.adventureId  
		where uc.userName = #{userName} and uc.payment = true; 
	]]>
	</select>


	<update id="updatePaymentsSuccess">
	<![CDATA[
			Update userCart
			set
			payment = true
			where userName = #{userName};
		]]>
	</update>
	<update id="updatePaymentFalse">
	<![CDATA[
			Update userCart
			set
			payment = false
			where userName = #{userName};
		]]>
	</update>

	<delete id="deletRE">
	<![CDATA[
			delete from userCart 
			where userName = #{userName} and replaceId = #{replaceInfo.replaceID};	
	]]>
	</delete>

	<delete id="deletAD">
	<![CDATA[
			delete from userCart 
			where userName = #{userName} and replaceId = #{replaceInfo.replaceID};	
	]]>
	</delete>

	<delete id="deletALL">
	<![CDATA[
			delete from userCart 
			where userName = #{userName} 
	]]>
	</delete>

	<resultMap id="userCartResult"
		type="com.example.test.User.DTO.UserCartDTO">
		<result property="startDate" column="startDate" />
		<result property="endDate" column="endDate" />
		<result property="payment" column="payment" />
		<association property="replaceInfo"
			javaType="com.example.test.replace.DTO.ReplaceDTO">
			<result column="Replace_key" property="replaceId" />
			<result column="MBTI_ID" property="mbtiID" />
			<result column="City_Key" property="cityID" />
			<result column="Post_CateGory_ID" property="postCategoryID" />
			<result column="RE_type_key" property="replaceType" />
			<result column="Replace_name" property="replaceName" />
			<result column="Replace_location" property="replaceLocation" />
			<result column="price" property="replacePrice" />
			<result column="contents" property="replaceContents" />
			<result column="tel" property="tel" />
			<result column="replace_admin" property="replaceAdmin" />
		</association>
		<association property="adventureInfo"
			javaType="com.example.test.Adventure.DTO.AdventureDTO">
			<result column="adventureID" property="adventureID" />
			<result column="adventureCategoryID"
				property="adventureCategoryID" />
			<result column="MBTI_ID" property="mbtiID" />
			<result column="City_Key" property="cityID" />
			<result column="Post_CateGory_ID" property="postCategoryID" />
			<result column="adventureTypeId" property="adventureTypeId" />
			<result column="adventureName" property="adventureName" />
			<result column="adventureLocation"
				property="adventureLocation" />
			<result column="adventurePrice" property="adventurePrice" />
			<result column="adventureContent" property="adventureContent" />
			<result column="tel" property="tel" />
			<result column="adventureAdmin" property="adventureAdmin" />
		</association>
	</resultMap>
</mapper>