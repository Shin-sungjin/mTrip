<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userCart">

	<insert id="insertItem" parameterType="hashMap"
		useGeneratedKeys="true">  
	<![CDATA[
		insert into userCart (userName, startDate, endDate, itemID, payment)
	    values
        (#{userName}, #{StartDate}, #{endDate}, #{itemId}, #{payment})
   	]]>
	</insert>


	<select id="detail" resultMap="hashMap">
	<![CDATA[
		SELECT 
		    uc.userName, 
		    uc.startDate, 
		    uc.endDate,
		    COALESCE(re.itemName, ad.itemName) AS itemName,
		    COALESCE(re.location, ad.location) AS location,
		    COALESCE(re.price, ad.adventurePrice) AS price,
		    COALESCE(re.contents, ad.contents) AS content,
		    COALESCE(re.ratingAvg, ad.ratingAvg) AS ratingAvg
		FROM 
		    userCart uc
		LEFT JOIN 
		    Item re ON uc.replaceId = re.itemId AND re.Type = 'replace'
		LEFT JOIN 
		    Item ad ON uc.adventureID = ad.itemId AND ad.Type = 'adventure'
		WHERE 
		    uc.userName = #{userName} AND uc.payment = false;	
	]]>
	</select>
	
	<select id="detailPay" resultMap="hashMap">
	 <![CDATA[
		SELECT 
		    uc.userName, 
		    uc.startDate, 
		    uc.endDate,
		    COALESCE(re.itemName, ad.itemName) AS itemName,
		    COALESCE(re.location, ad.location) AS location,
		    COALESCE(re.price, ad.price) AS price,
		    COALESCE(re.contents, ad.contents) AS content,
		    COALESCE(re.ratingAvg, ad.ratingAvg) AS ratingAvg
		FROM 
		    userCart uc
		LEFT JOIN 
		    Item re ON uc.replaceId = re.itemId AND re.Type = 'replace'
		LEFT JOIN 
		    Item ad ON uc.adventureID = ad.itemId AND ad.Type = 'adventure'
		WHERE 
		    uc.userName = #{userName} AND uc.payment = true;
	]]>
	</select>


	<update id="updatePaymentsSuccess">
	<![CDATA[
			Update userCart
			set
			payment = true
			where userName = #{userName};
		]]>
	</update>
	<update id="updatePaymentFalse">
	<![CDATA[
			Update userCart
			set
			payment = false
			where userName = #{userName};
		]]>
	</update>

	<delete id="deletItem">
	<![CDATA[
			delete from userCart 
			where userName = #{userName} and itemId = #{itemId};	
	]]>
	</delete>

	<delete id="deletALL">
	<![CDATA[
			delete from userCart 
			where userName = #{userName} 
	]]>
	</delete>


</mapper>