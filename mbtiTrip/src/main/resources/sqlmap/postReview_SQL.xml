<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper  namespace="postReview">

	<insert id="create" parameterType="hashMap" useGeneratedKeys="true"
		keyProperty="UID">  
	    <![CDATA[
	    insert into PostReview
	    (itemID,category,title,content,suggestion,views,updateDate,modifyDate,writer) 
	    values
	    (#{ItemID},#{Category},#{title},#{Content},#{suggestion},#{views},#{UpdateDate},#{modifyDate}, #{writer})
	]]>
	</insert>

	<select id="findByID" resultType="hashMap">
	 <![CDATA[
		SELECT ItemID 
		FROM PostReview
		WHERE userName=#{userName}; 
	]]>
	</select>

	<sql id="search">
        <if test="type != null and keyword != null">
            <trim prefix="(" suffix=") AND " prefixOverrides="OR">
                <foreach item="type" collection="typeArr">
                    <trim prefix="OR">
                        <choose>
                            <when test="type =='t'.toString()">
                                (TITLE LIKE '%'||#{keyword})||'%')
                            </when>
                            <when test="type =='c'.toString()">
                                (CONTENT LIKE '%'||#{keyword})||'%')
                            </when>
                            <when test="type =='w'.toString()">
                                (WRITER LIKE '%'||#{keyword})||'%')
                            </when>
                        </choose>
                    </trim>
                </foreach>
            </trim>
        </if>
    </sql>

	<!--    게시글 목록 가져오기-->
    <select id="getList" resultType="com.example.test.POST.DTO.PostReviewDTO">
        <![CDATA[
        SELECT ItemID, Category, title, content, suggestion, views, updateDate, modifyDate, writer 
        FROM
        (
            SELECT /*+ INDEX_DESC(TBL_postReview PK_postReview) */
            ROWNUM R, ItemID, Category, title, content, suggestion, views, updateDate, modifyDate, writer
            FROM TBL_postReview
            WHERE ROWNUM <= #{pageNum} * #{amount}
        )
           WHERE R> (#{pageNum}-1) * #{amount}
        ]]>

    </select>
	
	<select id="getTotal" resultType="_int">
      <![CDATA[
        SELECT COUNT(ItemID) FROM TBL_postReview
       <where>
         <include refid="search"></include>
       </where>
        ]]>
    </select>

	<update id="updateCount">
	<![CDATA[
			Update PostReview 
			set
			views = #{views},
			where itemID = #{ItemID};
		]]>
	</update>
	
	<delete id="delete">
	<![CDATA[
		
			delete from PostReview 
			where writer = #{writer} and itemID = #{ItemID};	
	]]>
	</delete>

</mapper>