<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="post">
	
	<insert id="insert" parameterType="hashMap" useGeneratedKeys="true"
		keyProperty="UID">  
	    <![CDATA[
	    insert into Post
	    (postID,postCategoryID,userName,title,content,suggestion,views,updateDate,modifyDate,writer) 
	    values
	    (#{PostId},#{PostCateGoryID},#{userName},#{title},#{Content},#{suggestion},#{views},#{UpdateDate},#{modifyDate}, #{writer})
	]]>
	</insert>
	
	<insert id="create" parameterType="hashMap">
		<![CDATA[
			INSERT INTO Post( title, postCategoryID, content, writer ) 
			VALUES ( #{title},#{PostCateGoryID}, #{content}, #{writer} )
		]]>	
	</insert>
	
	
	<insert id="save" parameterType="hashMap" useGeneratedKeys="true"
		keyProperty="UID">  
	    <![CDATA[
	    insert into Post
	    (postID,postCategoryID,userName,title,content,suggestion,views,updateDate,modifyDate,writer) 
	    values
	    (#{PostId},#{PostCateGoryID},#{userName},#{title},#{Content},#{suggestion},#{views},#{UpdateDate},#{modifyDate}, #{writer})
	]]>
	</insert>

	
	
	    <!-- 게시글 목록 가져오기 -->
    <select id="getList" resultType="com.example.test.POST.DTO.PostDTO">
        <![CDATA[
		select PostId,PostCateGoryID,userName,title,Content,suggestion,views,UpdateDate,modifyDate, writer
		from Post
        ]]>

    </select>
    
    <select id="getTotal" resultType="int">
		<![CDATA[
		SELECT COUNT(*) 
		FROM Post
		 ]]>
	</select>
	<!--  
    <select id="getTotal" resultType="int">
       <![CDATA[
		select COUNT(PostId)
		from Post 
       ]]>
    </select>-->
	
	<select id="findById" resultType="hashmap">
	 <![CDATA[
		SELECT PostID 
		FROM Post
		WHERE userName=#{userName}; 
	]]>
	</select>
	
	<select id="findByPostCategoryID" resultType="hashmap">
	 <![CDATA[
		SELECT PostCateGoryID 
		FROM Post
		WHERE postID = #{PostID} And userName=#{userName}; 
	]]>
	</select>

	<update id="updateCount">
	<![CDATA[
		UPDATE Post
		SET views = views + 1
		WHERE postID = #{PostID}
	]]>	
	</update>
	
	<update id="update">
		<![CDATA[
			UPDATE Post
			SET   title = #{title}
		     ,content = #{content}
		     ,writer = #{writer}
		WHERE postID = #{PostID}
		]]>
	</update>
	
	<delete id="delete">
		<![CDATA[
		DELETE
		FROM Post
		WHERE postID = #{PostID}
		]]>
	</delete>
	


	<update id="suggestion">
	<![CDATA[
		UPDATE Post
		SET suggestion = suggestion + 1
		WHERE postID = #{PostID}
	]]>	
	</update>
<!-- 
	<select id="getList" resultType="com.example.test.POST.DTO.PostDTO">
    <![CDATA[
    SELECT PostId,PostCateGoryID,userName,title,Content,suggestion,views,UpdateDate,modifyDate, writer
	FROM Post
        WHERE postID =#{PostId}
	AND ( 
		 title LIKE CONCAT('%', #{keyword}, '%')
		 OR Content LIKE CONCAT('%', #{keyword}, '%')
		 OR writer LIKE CONCAT('%', #{keyword}, '%')
	)
	ORDER BY UpdateDate DESC
	LIMIT #{pageNum} * #{amount}, #{amount};
    ]]>
    </select>

    <select id="getTotal" resultType="int">
    <![CDATA[
    SELECT COUNT(PostId) 
	FROM Post
	 WHERE postID =#{PostId}
	AND ( 
		 title LIKE CONCAT('%', #{keyword}, '%')
		 OR Content LIKE CONCAT('%', #{keyword}, '%')
		 OR writer LIKE CONCAT('%', #{keyword}, '%')
	)
	
    ]]>
    </select> 
 -->



</mapper>