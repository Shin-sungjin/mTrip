<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="post">
	
	<insert id="insert" parameterType="hashMap" useGeneratedKeys="true"
		keyProperty="UID">  
	    <![CDATA[
	    insert into Post
	    (postID,postCategoryID,userName,title,content,writer) 
	    values
	    (#{PostId},#{PostCateGoryID},#{userName},#{title},#{Content}, #{writer})
	]]>
	</insert>
	
	<select id="list" resultType="hashMap">
	<![CDATA[	
		SELECT *
		FROM Post
		WHERE PostId > 0
		ORDER BY updateDate DESC
		]]>
	</select>	        
	
	<select id="listWithPage" parameterType="hashMap" resultType="hashMap">
		<![CDATA[
			SELECT @rownum := @rownum+1 PostId, p.*
			FROM ( 
					SELECT @rownum := #{startRowIndex} 
					FROM dual
				 ) tmp
				 ,Post p
			ORDER BY updateDate DESC
			        
			LIMIT #{startRowIndex}, #{rowsPerPage}			
		]]>
	</select>
	
	<insert id="create" useGeneratedKeys="true" keyProperty="postID">
		<![CDATA[
			INSERT INTO Post( title, PostCateGoryID, Content,userName,itemID,UpdateDate) 
			VALUES ( #{title},#{postCategoryID},#{content},#{userName},#{itemID},#{updateDate})
		]]>	
	</insert>
	
	<select id="findById" resultType="com.example.test.POST.DTO.PostDTO">
	 <![CDATA[
		SELECT PostID as postID,PostCateGoryID as postCategoryID,userName,title,Content as content,suggestion,views,UpdateDate as updateDate,itemID
		FROM Post
		WHERE PostID=#{postId} 
	]]>
	</select>
	
	<update id="update">
		<![CDATA[
			UPDATE Post
			SET   title = #{title}
		     ,Content = #{content}
		     ,views = #{views}
		WHERE PostID = #{postID}
		]]>
	</update>
	
	<delete id="delete">
		<![CDATA[
		DELETE
		FROM Post
		WHERE postID = #{PostID}
		]]>
	</delete>
	
	<select id="searchByKeyword" resultType="hashmap">
		<![CDATA[
		SELECT *
		FROM Post
		WHERE PostID > 0
		  AND ( 
		  		  title LIKE CONCAT('%', #{keyword}, '%')
		  	   OR Content LIKE CONCAT('%', #{keyword}, '%')
		  	   OR writer LIKE CONCAT('%', #{keyword}, '%')
		  	  )
		ORDER BY updateDate DESC
		  ]]>      
	</select>
	
	<select id="searchByPage" resultType="hashmap">
		<![CDATA[
			SELECT @rownum := @rownum+1 AS PostId, P.*
			FROM (
   					 SELECT @rownum := :startRowIndex
					) AS tmp
			INNER JOIN Post P ON PostID > 0
			WHERE 
    			    title LIKE CONCAT('%', :keyword, '%')
    			OR Content LIKE CONCAT('%', :keyword, '%')
    			OR writer LIKE CONCAT('%', :keyword, '%')
			ORDER BY 
    				updateDate DESC,
    				
			LIMIT :startRowIndex OFFSET :startRowIndex
		]]>
	</select>
	
	<select id="totalCount" resultType="int">
		<![CDATA[
		SELECT COUNT(*) 
		FROM Post
		]]>
	</select>
	
	<select id="findByPostCategoryId" resultType="com.example.test.POST.DTO.PostDTO">
	 <![CDATA[
		SELECT *
		FROM Post
		WHERE PostCateGoryID = #{postCategoryID}
	]]>
	</select>
	
	<insert id="replyCreate" >
	<![CDATA[
		INSERT INTO PostAnswer ( postId, content, writer )
					VALUES ( #{postID}, #{content}, #{writer} )
	]]>				
	</insert>	
	
	<select id="replyList" resultType="hashmap">
	<![CDATA[
		SELECT * 
		FROM PostAnswer
		WHERE postId = #{postID}
		ORDER BY updateDate DESC
	]]>				 
	</select>

	<update id="replyUpdate" >
	<![CDATA[
		UPDATE PostAnswer
		SET   content = #{content}
		     ,writer = #{writer}
		WHERE answerId = #{answerID}
		]]>	
	</update>
	
	<delete id="replyDelete" parameterType="Int">
	<![CDATA[
		DELETE FROM PostAnswer
		WHERE answerId = #{answerID}
	]]>		
	</delete>
	
	
	<select id="titleCk" resultType="int">
		select count(*) from Post 
		where title = #{title};
	</select>
	
	
	
	
	


	



</mapper>